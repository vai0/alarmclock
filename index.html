<!DOCTYPE html>
<html>
  <head>
    <title>Alarm Clock!</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./style.css">
  </head>
  <body>
    <div id="main"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-router/4.0.0-0/react-router.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.js"></script>
    <script type="text/babel">

      (function() {

        //INITIAL DATA
        var alarmsdata = '[{ "id": 0, "time": { "src": { "hour": 7, "minute": 30, "second": 0 }, "formatted": { "hour": 7, "minute": 30, "period": "AM", "second": 0 } }, "days": { "sun": false, "mon": true, "tue": true, "wed": true, "thu": true, "fri": true, "sat": false }, "repeat": true, "snooze": true, "vibrate": false, "activated": true }, { "id": 1, "time": { "src": { "hour": 22, "minute": 30, "second": 0 }, "formatted": { "hour": 10, "minute": 30, "period": "PM", "second": 0 } }, "days": { "sun": true, "mon": false, "tue": false, "wed": false, "thu": false, "fri": false, "sat": true }, "repeat": true, "snooze": true, "vibrate": false, "activated": false }]';
        var settingsdata = '{"militarytime": false, "temperature": "f", "locationservice": true}';

        //React App
        var Main = React.createClass({
          getDefaultProps: function() {
            return {
              alarms: JSON.parse(alarmsdata),
              settings: JSON.parse(settingsdata),
            };
          },
          getInitialState: function() {
            return {
              alarms: this.props.alarms,
              settings: this.props.settings,
              currentTime: null,
              location: null,
              weather: null
            };
          },
          _startClock: function() {
            var time = new Date();
            var day = time.getDay();
            var hour = time.getHours();
            var minute = time.getMinutes();
            var second = time.getSeconds();
            var twelveHourTime = convertSrcTimeToTwelveHour(hour, minute, second);
            this.setState({
              currentTime: {
                src: {
                  day: day,
                  hour: hour,
                  minute: minute,
                  second: second
                },
                formatted: twelveHourTime
              }
            });
            console.log(day+':'+hour+':'+minute+':'+second);
            setTimeout(this._startClock, 1000);
          },
          _getLocation: function() {
            if (!navigator.geolocation) {
              alert('Geolocation is not supported by this browser, maybe use a pop-up and ask user for zipcode?');
            }
            function success(position) {
              var latitude = position.coords.latitude;
              var longitude = position.coords.longitude;
              this.setState({
                location: {
                  latitude: latitude,
                  longitude: longitude
                }
              });
              this._getWeather(this.state.location.latitude, this.state.location.longitude);
            }
            function error() {
              this.setState({
                location: 'location blocked'
              });
            }
            navigator.geolocation.getCurrentPosition(success.bind(this), error.bind(this));
          },
          _getWeather: function(latitude, longitude) {
            var request = new XMLHttpRequest();
            request.open('GET', 'http://api.openweathermap.org/data/2.5/weather?lat='+latitude+'&lon='+longitude+'&APPID=11063795b43e3d923147da4c5f10100b', true);
            request.onload = function() {
              if (request.status >= 200 && request.status < 400) { //success
                this.setState({
                  weather: JSON.parse(request.responseText)
                });
              } else { //reach server, but receive an error
                console.log('openweathermap API reached, but received status error: ', request.status);
              }
            }.bind(this);
            request.onerror = function() {
              console.log('openweathermap request - some sort of connection error occurred');
            };
            request.send();
          },
          _toggleAlarm: function(alarmid) {
            var newAlarms = this.state.alarms.map(function(alarm) {
              if (alarmid === alarm.id) alarm.activated = !alarm.activated;
              return alarm;
            });
            this.setState({
              alarms: newAlarms
            });
          },
          _addAlarm: function(newAlarm) {
            var newAlarms = this.state.alarms.slice();
            newAlarms.push(newAlarm);
            this.setState({
              alarms: newAlarms
            });
          },
          _updateAlarm: function(updatedalarm) {
            var newAlarms = this.state.alarms.map(function(alarm) {
              if (alarm.id === updatedalarm.id) {
                return updatedalarm;
              }
              return alarm;
            });
            this.setState({
              alarms: newAlarms
            });
          },
          _deleteAlarm: function(alarmid) {
            var newAlarms = this.state.alarms.filter(function(alarm) {
              return alarm.id !== alarmid;
            });
            this.setState({
              alarms: newAlarms
            });
          },
          _setTemperatureSetting: function(event) {
            var newSettings = JSON.parse(JSON.stringify(this.state.settings));
            var temp = event.target.dataset.temp;
            newSettings['temperature'] = temp;
            this.setState({
              settings: newSettings
            });
          },
          _setMilitaryTime: function(event) {
            var newSettings = JSON.parse(JSON.stringify(this.state.settings));
            newSettings['militarytime'] = !this.state.settings.militarytime;
            this.setState({
              settings: newSettings
            });
          },
          _getAlarmCount: function() {
            return this.state.alarms.length;
          },
          componentWillMount: function() {
            this._startClock();
            this._getLocation();
          },
          // shouldComponentUpdate: function(nextProps, nextState) {
          //   return nextState !== this.state;
          // },
          render: function() {
            return (
              <div className="Main">
                <AlarmPage alarms={this.state.alarms} weather={this.state.weather} settings={this.state.settings} _toggleAlarm={this._toggleAlarm} currentTime={this.state.currentTime} _updateAlarm={this._updateAlarm} _deleteAlarm={this._deleteAlarm} _toggleAlarm={this._toggleAlarm} _getAlarmCount={this._getAlarmCount} _addAlarm={this._addAlarm} _setTemperatureSetting={this._setTemperatureSetting} _setMilitaryTime={this._setMilitaryTime} />
              </div>
            )
          }
        });

        var AlarmPage = React.createClass({
          getDefaultProps: function() {
            return {
              showEditAlarmPage: false,
              showAddAlarmPage: false,
              showSettingsPage: false,
              showAlarmTriggeredPage: false
            };
          },
          getInitialState: function() {
            return {
              showEditAlarmPage: this.props.showEditAlarmPage,
              showAddAlarmPage: this.props.showAddAlarmPage,
              showSettingsPage: this.props.showSettingsPage,
              showAlarmTriggeredPage: this.props.showAlarmTriggeredPage,
              alarmBeingEdited: {}
            };
          },
          _openEditAlarmPage: function(event) {
            var alarm = this.props.alarms.filter(function(alarm) {
              return alarm.id === parseInt(event.currentTarget.dataset.alarmid);
            })[0];
            this.setState({
              showEditAlarmPage: true,
              alarmBeingEdited: alarm
            });
          },
          _openAddAlarmPage: function() {
            this.setState({
              showAddAlarmPage: true
            });
          },
          _openSettingsPage: function() {
            this.setState({
              showSettingsPage: true
            });
          },
          _closeEditAlarmPage: function() {
            this.setState({
              showEditAlarmPage: false
            });
          },
          _closeAddAlarmPage: function() {
            this.setState({
              showAddAlarmPage: false
            });
          },
          _closeSettingsPage: function() {
            this.setState({
              showSettingsPage: false
            });
          },
          _closeAlarmTriggeredPage: function() {
            this.setState({
              showAlarmTriggeredPage: false
            });
          },
          componentWillReceiveProps: function(nextProps) {
            //console.log(this.props.currentTime.hour + ':' + this.props.currentTime.minute + ':' + this.props.currentTime.second);
            //trigger alarm when time's up
            this.props.alarms.forEach(function(alarm) {
              if (alarm.activated &&
                (alarm.time.src.hour === this.props.currentTime.src.hour) &&
                (alarm.time.src.minute === this.props.currentTime.src.minute) &&
                (alarm.time.src.second === this.props.currentTime.src.second) &&
                ((alarm.repeat === false) || (alarm.repeat === true && alarm.days[convertIndextoDay(this.props.currentTime.src.day)]))) {
                if (!alarm.repeat) {
                  this.props._toggleAlarm(alarm.id);
                }
                this.setState({
                  showAlarmTriggeredPage: true
                });
              }
            }, this);
          },
          render: function() {
            if (this.state.showEditAlarmPage) {
              return <EditAlarmPage settings={this.props.settings} alarmBeingEdited={this.state.alarmBeingEdited} _updateAlarm={this.props._updateAlarm} _deleteAlarm={this.props._deleteAlarm} _closeEditAlarmPage={this._closeEditAlarmPage} />
            }
            if (this.state.showAddAlarmPage) {
              return <AddAlarmPage settings={this.props.settings} currentTime={this.props.currentTime} _getAlarmCount={this.props._getAlarmCount} _addAlarm={this.props._addAlarm} showAddAlarmPage={this.state.showAddAlarmPage} _closeAddAlarmPage={this._closeAddAlarmPage} />
            }
            if (this.state.showSettingsPage) {
              return <SettingsPage settings={this.props.settings} _setTemperatureSetting={this.props._setTemperatureSetting} _setMilitaryTime={this.props._setMilitaryTime} _closeSettingsPage={this._closeSettingsPage}/>
            }
            if (this.state.showAlarmTriggeredPage) {
              return <AlarmTriggeredPage weather={this.props.weather} currentTime={this.props.currentTime} settings={this.props.settings} _closeAlarmTriggeredPage={this._closeAlarmTriggeredPage} />
            }
            return (
              <div className="AlarmPage">
                <h1>Wakey</h1>
                <AlarmList alarms={this.props.alarms} settings={this.props.settings} _getAlarmId={this._getAlarmId} _toggleAlarm={this.props._toggleAlarm} _closeEditAlarmPage={this._closeEditAlarmPage} _openEditAlarmPage={this._openEditAlarmPage} />
                <button onClick={this._openSettingsPage}>Settings</button>
                <button onClick={this._openAddAlarmPage}>&#43;</button>
              </div>
            )
          }
        });

        var AlarmList = React.createClass({
          render: function() {
            return (
              <div className="AlarmList">
                {this.props.alarms.map(function(alarm, index) {
                  return (
                    <AlarmElement alarm={alarm} settings={this.props.settings} data-alarmid={alarm.id} key={index} _getAlarmId={this.props._getAlarmId} _toggleAlarm={this.props._toggleAlarm} _closeEditAlarmPage={this.props._closeEditAlarmPage} _openEditAlarmPage={this.props._openEditAlarmPage}></AlarmElement>
                  )
                }, this)}
              </div>
            )
          }
        });

        var AlarmElement = React.createClass({
          getInitialState: function() {
            return {
              editable: false
            }
          },
          _toggleAlarmActivated: function() {
            this.props._toggleAlarm(this.props.alarm.id);
          },
          _renderDays: function() {
            if (this.props.alarm.repeat) {
              return (
                <div className="days">
                  {Object.keys(this.props.alarm.days).map(function(key, index) {
                    if (this.props.alarm.days[key]) {
                      return <span className="day" key={index}>{capitalize(key)}</span>;
                    }
                  }, this)}
                </div>
              )
            } else {
              return null;
            }
          },
          _renderTime: function() {
            return (this.props.settings.militarytime) ?
              <div className="time">{this.props.alarm.time.src.hour + ':' + setTwoDigit(this.props.alarm.time.src.minute)}</div> :
              <div className="time">{this.props.alarm.time.formatted.hour + ':' + setTwoDigit(this.props.alarm.time.formatted.minute) + ' ' + this.props.alarm.time.formatted.period}</div>;
          },
          render: function() {
            var activated = (this.props.alarm.activated) ? 'toggleOn' : 'toggleOff';
            return (
              <div className="AlarmElement">
                <div data-alarmid={this.props.alarm.id} onClick={this.props._openEditAlarmPage}>
                  {this._renderTime()}
                  {this._renderDays()}
                </div>
                <input type="checkbox" id={this.props.alarm.id} defaultChecked={this.props.alarm.activated} onClick={this._toggleAlarmActivated} />
              </div>
            )
          }
        });

        var EditAlarmPage = React.createClass({
          getInitialState: function() {
            return {
              id: this.props.alarmBeingEdited.id,
              time: {
                src: {
                  hour: this.props.alarmBeingEdited.time.src.hour,
                  minute: this.props.alarmBeingEdited.time.src.minute,
                  second: this.props.alarmBeingEdited.time.src.second
                },
                formatted: {
                  hour: this.props.alarmBeingEdited.time.formatted.hour,
                  minute: this.props.alarmBeingEdited.time.formatted.minute,
                  second: this.props.alarmBeingEdited.time.formatted.second,
                  period: this.props.alarmBeingEdited.time.formatted.period
                }
              },
              days: {
                'sun': this.props.alarmBeingEdited.days['sun'],
                'mon': this.props.alarmBeingEdited.days['mon'],
                'tue': this.props.alarmBeingEdited.days['tue'],
                'wed': this.props.alarmBeingEdited.days['wed'],
                'thu': this.props.alarmBeingEdited.days['thu'],
                'fri': this.props.alarmBeingEdited.days['fri'],
                'sat': this.props.alarmBeingEdited.days['sat']
              },
              repeat: this.props.alarmBeingEdited.repeat,
              snooze: this.props.alarmBeingEdited.snooze,
              vibrate: this.props.alarmBeingEdited.vibrate,
              activated: this.props.alarmBeingEdited.activated
            }
          },
          _switchToggle: function(event) {
            var newState = {};
            var key = event.target.dataset.input;
            newState[key] = !this.state[key];
            this.setState(newState);
          },
          _selectDay: function(event) {
            var newDays = JSON.parse(JSON.stringify(this.state.days));
            var key = event.target.dataset.day;
            newDays[key] = !this.state.days[key];
            this.setState({
              days: newDays
            });
          },
          _onSave: function() {
            this.props._updateAlarm(this.state);
            this.props._closeEditAlarmPage();
          },
          _onDelete: function() {
            this.props._deleteAlarm(this.state.id);
            this.props._closeEditAlarmPage();
          },
          _changeHour: function(event) {
            var newTime = JSON.parse(JSON.stringify(this.state.time));
            if (this.props.settings.militarytime) {
              newTime.src.hour = parseInt(event.target.value);
              newTime.formatted = convertSrcTimeToTwelveHour(newTime.src.hour, newTime.src.minute, 0);
            } else {
              newTime.formatted.hour = parseInt(event.target.value);
              newTime.src = convertFormattedToSrcTime(newTime.formatted.hour, newTime.formatted.minute, 0, newTime.formatted.period);
            }
            this.setState({
              time: newTime
            });
          },
          _changeMinute: function(event) {
            var newTime = JSON.parse(JSON.stringify(this.state.time));
            newTime.formatted.minute = parseInt(event.target.value);
            newTime.src.minute = newTime.formatted.minute;
            this.setState({
              time: newTime
            });
          },
          _changePeriod: function(event) {
            var newTime = JSON.parse(JSON.stringify(this.state.time));
            newTime.formatted.period = event.target.value;
            newTime.src = convertFormattedToSrcTime(newTime.formatted.hour, newTime.formatted.minute, 0, event.target.value);
            this.setState({
              time: newTime
            });
          },
          _onClickRepeat: function() {
            this.setState({
              repeat: !this.state.repeat
            });
          },
          _renderDays: function() {
            if (this.state.repeat) {
              return (
                <div className="days">
                  {Object.keys(this.state.days).map(function(key, index) {
                    var dayClass = 'day';
                    if (this.state.days[key]) dayClass += ' day-on';
                    return <button data-day={key} className={dayClass} key={index} onClick={this._selectDay}>{capitalize(key)}</button>;
                  }, this)}
                </div>
              )
            } else {
              return null;
            }
          },
          _renderTime: function() {
            if (this.props.settings.militarytime) {
              return (
                <div className="time">
                  <input type="text" defaultValue={this.state.time.src.hour} onChange={this._changeHour}/>
                  :<input type="text" defaultValue={this.state.time.src.minute} onChange={this._changeMinute}/>
                </div>
              );
            } else {
              return (
                <div className="time">
                  <input type="text" defaultValue={this.state.time.formatted.hour} onChange={this._changeHour}/>
                  :<input type="text" defaultValue={this.state.time.formatted.minute} onChange={this._changeMinute}/>
                  <div className="period">
                   <input type="radio" name="period" value="AM" checked={this.state.time.formatted.period === 'AM'} onChange={this._changePeriod} />AM
                   <input type="radio" name="period" value="PM" checked={this.state.time.formatted.period === 'PM'} onChange={this._changePeriod} />PM
                 </div>
                </div>
              );
            }
          },
          render: function() {
            return (
              <div className="EditAlarmPage">
                <button onClick={this.props._closeEditAlarmPage}>&#60;</button>
                <button onClick={this._onDelete}>Delete</button>
                <h1>Edit</h1>
                {this._renderTime()}
                Repeat: <input type="checkbox" defaultChecked={this.state.repeat} onClick={this._onClickRepeat} />
                {this._renderDays()}
                <div className="snooze">Snooze<input type="checkbox" data-input="snooze" defaultChecked={this.state.snooze} onChange={this._switchToggle}/></div>
                <div className="vibrate">Vibrate<input type="checkbox" data-input="vibrate" defaultChecked={this.state.vibrate} onChange={this._switchToggle}/></div>
                <button onClick={this._onSave}>Save</button>
              </div>
            )
          }
        });

        var AddAlarmPage = React.createClass({
          getInitialState: function() {
            var currentHour = this.props.currentTime.src.hour;
            var currentMinute = this.props.currentTime.src.minute;
            var twelveHourTime = convertSrcTimeToTwelveHour(currentHour, currentMinute, 0);
            return {
              id: this.props._getAlarmCount(),
              time: {
                src: {
                  hour: currentHour,
                  minute: currentMinute,
                  second: 0
                },
                formatted: twelveHourTime
              },
              days: {
                'sun': true,
                'mon': true,
                'tue': true,
                'wed': true,
                'thu': true,
                'fri': true,
                'sat': true
              },
              repeat: false,
              snooze: true,
              vibrate: false,
              activated: true
            }
          },
          _switchToggle: function(event) {
            var newState = {};
            var key = event.target.dataset.input;
            newState[key] = !this.state[key];
            this.setState(newState);
          },
          _selectDay: function(event) {
            var newDays = JSON.parse(JSON.stringify(this.state.days));
            var key = event.target.dataset.day;
            newDays[key] = !this.state.days[key];
            this.setState({
              days: newDays
            });
          },
          _onSave: function() {
            this.props._addAlarm(this.state);
            this.props._closeAddAlarmPage();
          },
          _changeHour: function(event) {
            var newTime = JSON.parse(JSON.stringify(this.state.time));
            if (this.props.settings.militarytime) {
              newTime.src.hour = parseInt(event.target.value);
              newTime.formatted = convertSrcTimeToTwelveHour(newTime.src.hour, newTime.src.minute, 0);
            } else {
              newTime.formatted.hour = parseInt(event.target.value);
              newTime.src = convertFormattedToSrcTime(newTime.formatted.hour, newTime.formatted.minute, 0, newTime.formatted.period);
            }
            this.setState({
              time: newTime
            });
          },
          _changeMinute: function(event) {
            var newTime = JSON.parse(JSON.stringify(this.state.time));
            newTime.formatted.minute = parseInt(event.target.value);
            newTime.src.minute = newTime.formatted.minute;
            this.setState({
              time: newTime
            });
          },
          _changePeriod: function(event) {
            var newTime = JSON.parse(JSON.stringify(this.state.time));
            newTime.formatted.period = event.target.value;
            newTime.src = convertFormattedToSrcTime(newTime.formatted.hour, newTime.formatted.minute, 0, event.target.value);
            this.setState({
              time: newTime
            });
          },
          _onClickRepeat: function() {
            this.setState({
              repeat: !this.state.repeat
            });
          },
          componentWillReceiveProps: function(nextProps) {
            this.setState({
              id: nextProps._getAlarmCount()
            });
          },
          _renderDays: function() {
            if (this.state.repeat) {
              return (
                <div className="days">
                  {Object.keys(this.state.days).map(function(key, index) {
                    var dayClass = 'day';
                    if (this.state.days[key]) dayClass += ' day-on';
                    return <button data-day={key} className={dayClass} key={index} onClick={this._selectDay}>{capitalize(key)}</button>;
                  }, this)}
                </div>
              )
            } else {
              return null;
            }
          },
          _renderTime: function() {
            if (this.props.settings.militarytime) {
              return (
                <div className="time">
                  <input type="text" defaultValue={this.state.time.src.hour} onChange={this._changeHour}/>
                  :<input type="text" defaultValue={this.state.time.src.minute} onChange={this._changeMinute}/>
                </div>
              );
            } else {
              return (
                <div className="time">
                  <input type="text" defaultValue={this.state.time.formatted.hour} onChange={this._changeHour}/>
                  :<input type="text" defaultValue={this.state.time.formatted.minute} onChange={this._changeMinute}/>
                  <div className="period">
                   <input type="radio" name="period" value="AM" checked={this.state.time.formatted.period === 'AM'} onChange={this._changePeriod} />AM
                   <input type="radio" name="period" value="PM" checked={this.state.time.formatted.period === 'PM'} onChange={this._changePeriod} />PM
                 </div>
                </div>
              );
            }
          },
          render: function() {
            if (this.props.showAddAlarmPage) {
              return (
                  <div className="AddAlarmPage">
                    <button onClick={this.props._closeAddAlarmPage}>&#60;</button>
                    <h1>New Alarm</h1>
                    {this._renderTime()}
                    Repeat: <input type="checkbox" defaultChecked={this.state.repeat} onClick={this._onClickRepeat} />
                    {this._renderDays()}
                    <div className="snooze">Snooze<input type="checkbox" data-input="snooze" defaultChecked={this.state.snooze} onChange={this._switchToggle}/></div>
                    <div className="vibrate">Vibrate<input type="checkbox" data-input="vibrate" defaultChecked={this.state.vibrate} onChange={this._switchToggle}/></div>
                    <button onClick={this._onSave}>Save</button>
                  </div>
              )
            } else {
              return null;
            }
          }
        });

        var SettingsPage = React.createClass({
          _setTemperatureSettingEvent: function(event) {
            this.props._setTemperatureSetting(event);
          },
          _renderTemperatureButton: function() {
            if (this.props.settings.temperature === 'c') {
              return (
                <span>
                  <button data-temp="c" className="temperatureButton temp-on" onClick={this._setTemperatureSettingEvent}>&deg;C</button>
                  <button data-temp="f" className="temperatureButton" onClick={this._setTemperatureSettingEvent}>&deg;F</button>
                </span>
              )
            } else if (this.props.settings.temperature === 'f') {
              return (
                <span>
                  <button data-temp="c" className="temperatureButton" onClick={this._setTemperatureSettingEvent}>&deg;C</button>
                  <button data-temp="f" className="temperatureButton temp-on" onClick={this._setTemperatureSettingEvent}>&deg;F</button>
                </span>
              )
            }
          },
          _setMilitaryTimeEvent: function(event) {
            this.props._setMilitaryTime(event);
          },
          render: function() {
            return (
              <div className="SettingsPage">
                <button onClick={this.props._closeSettingsPage}>&#60;</button>
                <h1>Settings</h1>
                <div className="militarytime">24-Hour Time<input type="checkbox" defaultChecked={this.props.settings.militarytime} onClick={this._setMilitaryTimeEvent}/></div>
                <div className="temperatureFormat">
                  Temperature: {this._renderTemperatureButton()}
                </div>
              </div>
            )
          }
        });

        var AlarmTriggeredPage = React.createClass({
          //weather conditions
          // < 600 is rain
          // 600 < x < 700 is snow
          // 800 is clear_day
          // 801 partly_cloudy
          // 802 <= x <= 804 overcast
          _onStop: function() {
            this.props._closeAlarmTriggeredPage();
          },
          _renderTime: function() {
            if (this.props.settings.militarytime) {
              return <div className="currentTime">{this.props.currentTime.src.hour}:{this.props.currentTime.src.minute}</div>
            } else {
              return <div className="currentTime">{this.props.currentTime.formatted.hour}:{this.props.currentTime.formatted.minute + ' ' + this.props.currentTime.formatted.period}</div>
            }
          },
          _renderWeather: function() {
            var weatherImage;
            var weatherConditionId = this.props.weather.weather[0].id;
            if (this.props.weather) {
              if (weatherConditionId < 600) {
                weatherImage = <img src="./images/rain.png" />
              } else if (weatherConditionId < 700) {
                weatherImage = <img src="./images/snow.png" />
              } else if (weatherConditionId === 800) {
                weatherImage = <img src="./images/clear_day.png" />
              } else if (weatherConditionId === 801) {
                weatherImage = <img src="./images/partly_cloudy.png" />
              } else if (weatherConditionId < 805) {
                weatherImage = <img src="./images/overcast.png" />
              } else {
                weatherImage = <span>weather id is invalid, check the API docs: http://openweathermap.org/weather-conditions weatherConditionId: {weatherConditionId}</span>;
              }
            } else {
              console.log('geolocation or weather data was not received when alarm triggered, will not display weather information.');
            }
            return <div className="weatherImage">{weatherImage}</div>;
          },
          _renderAudio: function() {
            var weatherConditionId = this.props.weather.weather[0].id;
            var audioPath = './audio/';
            var audioSrc;
            if (this.props.weather) {
              if (weatherConditionId < 600) {
                audioSrc = audioPath + "1.mp3";
              } else if (weatherConditionId < 700) {
                audioSrc = audioPath + "2.mp3";
              } else if (weatherConditionId === 800) {
                audioSrc = audioPath + "3.mp3";
              } else if (weatherConditionId === 801) {
                audioSrc = audioPath + "4.mp3";
              } else if (weatherConditionId < 805) {
                audioSrc = audioPath + "5.mp3";
              } else {
                console.log("weather id is invalid, check the API docs: http://openweathermap.org/weather-conditions weatherConditionId: ", weatherConditionId);
              }
            } else {
              console.log('will not display weather information. geolocation or weather data was not received when alarm triggered.');
            }
            return <audio id="weatherTrack" src={audioSrc} autoPlay loop></audio>;
          },
          _renderTemperature: function() {
            var temperature;
            if (this.props.settings.temperature === "c") {
              temperature = convertKelvinToCelsius(this.props.weather.main.temp);
            } else if (this.props.settings.temperature === "f") {
              temperature = convertKelvinToFahrenheit(this.props.weather.main.temp);
            } else {
              temperature = "something's not right...check this.props.settings.temperature";
            }
            return <div className="temperature">{temperature}&deg;</div>
          },
          render: function() {
            return (
              <div className="AlarmTriggeredPage">
                <h1>Alarm Triggered Page</h1>
                {this._renderWeather()}
                {this._renderTemperature()}
                {this._renderTime()}
                {this._renderAudio()}
                <div className="triggerPageDescription">Tap to snooze</div>
                <button onClick={this._onStop}>Stop</button>
              </div>
            )
          }
        });

        ReactDOM.render(
          <Main />,
          document.getElementById('main')
        );

                  // Helper functions
                  function setTwoDigit(number) {
                    return (number < 10) ? '0' + number.toString() : number.toString();
                  }

                  function capitalize(str) {
                    return str[0].toUpperCase() + str.slice(1);
                  }

                  function convertDayToIndex(day) {
                    return ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'].indexOf(day);
                  }

                  function convertIndextoDay(index) {
                    return ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'][index];
                  }

                  function convertKelvinToFahrenheit(k) {
                    return Math.round(9/5 * (k - 273) + 32);
                  }

                  function convertKelvinToCelsius(k) {
                    return Math.round(k - 273);
                  }

                  function convertFormattedToSrcTime(hour, minute, second, period) {
                    var militaryHour = hour;
                    if (period === 'PM') {
                    	militaryHour = (hour === 12) ? 12 : hour + 12;
                    } else if (period === 'AM') {
                    	militaryHour = (hour === 12) ? 0 : hour;
                    }
                    return {
                      hour: militaryHour,
                      minute: minute,
                      second: second
                    }
                  }

                  function convertSrcTimeToTwelveHour(hour, minute, second) {
                    var newHour = hour;
                    var period = 'AM';
                    if (hour === 0) {
                    	newHour = 12;
                    }
                    if (hour > 12) {
                      newHour = hour - 12;
                      period = 'PM';
                    }
                    return {
                      hour: newHour,
                      minute: minute,
                      second: second,
                      period: period
                    }
                  }
      })();
    </script>
  </body>
</html>
